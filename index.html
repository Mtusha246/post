<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Social App üöÄ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9fafb; color: #333; }
    h1 { color: #444; }
    textarea, input, button { display: block; margin-top: 10px; font-size: 1em; }
    textarea { width: 400px; height: 70px; padding: 6px; }
    input[type="text"] { width: 350px; padding: 6px; }
    button { cursor: pointer; padding: 8px 16px; background: #007bff; color: #fff; border: none; border-radius: 6px; margin-top: 8px; }
    button:hover { background: #0056b3; }
    .post { border: 1px solid #ccc; background: #fff; border-radius: 8px; padding: 12px; margin-top: 15px; }
    .comments { margin-top: 10px; border-top: 1px solid #eee; padding-top: 8px; }
    .comment { margin-left: 10px; color: #555; }
  </style>
</head>
<body>
  <h1>Mini Social App üöÄ</h1>

  <h3>Create a New Post</h3>
  <textarea id="postContent" placeholder="Write your post..."></textarea>
  <button onclick="createPost()">Create Post</button>

  <h3>Posts</h3>
  <div id="posts">Loading...</div>

  <script>
    const API_BASE = window.location.origin; // –∞–≤—Ç–æ–º–∞—Ç–æ–º –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç Railway URL

    async function fetchPosts() {
      const container = document.getElementById('posts');
      container.textContent = 'Loading...';
      try {
        const res = await fetch(`${API_BASE}/posts`);
        if (!res.ok) throw new Error('Failed to load posts');
        const posts = await res.json();
        renderPosts(posts);
      } catch (err) {
        container.textContent = 'Error: ' + err.message;
      }
    }

    async function createPost() {
      const content = document.getElementById('postContent').value.trim();
      if (!content) return alert('Please write something!');
      try {
        const res = await fetch(`${API_BASE}/posts`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content })
        });
        if (!res.ok) throw new Error('Failed to create post');
        document.getElementById('postContent').value = '';
        fetchPosts();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function deletePost(id) {
      if (!confirm('Delete this post?')) return;
      try {
        const res = await fetch(`${API_BASE}/posts/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error('Delete failed');
        fetchPosts();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function addComment(postId) {
      const input = document.getElementById(`commentInput-${postId}`);
      const commentContent = input.value.trim();
      if (!commentContent) return alert('Enter a comment first!');
      try {
        const res = await fetch(`${API_BASE}/posts/${postId}/comments`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ commentContent })
        });
        if (!res.ok) throw new Error('Failed to add comment');
        input.value = '';
        fetchPosts();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    function renderPosts(posts) {
      const container = document.getElementById('posts');
      if (!Array.isArray(posts) || posts.length === 0) {
        container.innerHTML = '<i>No posts yet.</i>';
        return;
      }

      container.innerHTML = posts.map(p => `
        <div class="post">
          <b>Post #${p.id}</b><br>
          ${escapeHtml(p.content)}<br>
          <button onclick="deletePost(${p.id})">üóëÔ∏è Delete</button>

          <div class="comments">
            <b>Comments:</b><br>
            ${(p.comments && p.comments.length > 0)
              ? p.comments.map(c => `<div class="comment">üí¨ ${escapeHtml(c.content)}</div>`).join('')
              : '<i>No comments yet</i>'}
            <input id="commentInput-${p.id}" type="text" placeholder="Add a comment...">
            <button onclick="addComment(${p.id})">Add Comment</button>
          </div>
        </div>
      `).join('');
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    fetchPosts();
  </script>
</body>
</html>
